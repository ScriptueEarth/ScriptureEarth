<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Espanol Language Setup</title>
<meta http-equiv="Content-Type"  content="text/html; charset=utf-8" />
<meta http-equiv="Window-target" content="_top" />
<meta name="ObjectType"          content="Document" />
<meta name="ROBOTS"              content="NOINDEX" />
</head>
<body>
<?php
function check_input($value) {						// used for ' and " that find it in the input
	$value = trim($value);
    /* Automatic escaping is highly deprecated, but many sites do it anyway. */
	// Stripslashes
	if (function_exists('get_magic_quotes_gpc') && get_magic_quotes_gpc()) {
	  $value = stripslashes($value);
	}
	// Quote if not a number
	if (!is_numeric($value)) {
		$db = get_my_db();
		$value = $db->real_escape_string($value);
	}
	return $value;
}

if (isset($_GET["noDisplay"])) {
	if ($_GET["noDisplay"] == 1)
		$Display = 0;
	else
		$Display = 1;
}
else
	$Display = 1;

include '../../include/conn.inc.php';
$db = get_my_db();

$fileFirstPart = 
'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Scripture Earth Espanol Language Setup</title>
<meta http-equiv="Content-Type" 			content="text/html; charset=utf-8" />
<meta name="ObjectType" 					content="Document" />
<meta http-equiv="Window-target" 			content="_top" />
<meta name="Description" lang="en-US" 		content="
		Este sitio provee acceso a la Biblia/NT en texto (PDF),
		audio (MP3), vea (la película JESÚS, etc.), compre (se imprimen a pedido),
		estudie (La Palabra), otros libros y enlaces en los idiomas autóctonos de las Américas.
	" />
<meta name="Keywords" lang="en-US" 			content="
		recursos Bíblicos, lengua,
		idiomas autóctonos modernos, las Américas, lengua materna,
		lenguas indígenas, texto, PDF, audio, MP3, vea, la película JESÚS,
		se imprime a pedido, compre el libro en línea, compra en línea, internet, tienda, libro,
		estudie, módulos de estudio Bíblico, La Palabra, Biblia, Nuevo Testamento, NT, Antiguo Testamento, AT,
';
$fileSecondPart = '';
$fileThirdPart = '" />
<meta name="Created-by" 					content="Scott Starker" />
<meta name="Maintained-by" 					content="Website" />
<meta name="Approved-by" 					content="Bill Dyck, Access Coordinator" />
<meta name="Copyright" 						content="' . date('Y') . '" />
<style type="text/css">
#container {
	width: 980px;  /* using 20px less than a full 800px width allows for browser chrome and avoids a horizontal scroll bar */
	background-color: #FFFFFF;
	margin: 0 auto 0 auto; /* the auto margins (in conjunction with a width) center the page */
	padding-bottom: -20px;
	text-align: left; /* this overrides the text-align: center on the body element. */
}
</style>
</head>
<body>
<div id="container">
<img src="../../images/topBannerCompSplash.jpg" style="position: relative; top: 0px; z-index: 1; width: 100%; " /><br /><br />
&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 10pt; font-style: italic; ">PDF<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Audio (<a href="http://www.faithcomesbyhearing.com/ambassador/free-audio-bible-download">Faith Comes By Hearing</a>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Video (<a href="http://www.inspirationalfilms.com/av/watch.html">The JESUS Film</a>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Módulos de Estudio Bíblico (<a href="http://www.theword.gr/">The Word</a>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Compre el libro en línea (Internet) (<a href="http://www.virtualstorehouse.org/">Virtual Storehouse</a>)</span><br /><br />
<span style="color: #003366; font-size: 11pt; ">Haga <span style="font-size: 14pt; font-weight: bold; ">Clic</span> aquí para encontrar <span style="font-size: 12pt; font-weight: bold; ">Recursos de las Escrituras</span> (Nuevo Testamento o Biblia completa) en los siguientes idiomas…</span><br />';
$fileFourthPart = '';
$fileFifthPart = '</div>
</body>
</html>';

	if ($Display) {
		echo "<div style='background-color: white; padding: 20px; width: 800px; margin-left: auto; margin-right: auto; '>";
		echo "<h2 style='text-align: center; margin: 0px; color: navy; '>Scripture Earth Espanol Language Setup</h2><br /><br />";
	}
	
	$query = "SELECT * FROM scripture_main";
	$result=$db->query($query) or die ("Query failed: " . $db->error . "</body></html>");
	if (!$result || ($result->numrows < 1)) {
		die ("Cannot SELECT from 'scripture_main'. " . $db->error . "</body></html>");
	}
	$db->query("DROP TABLE IF EXISTS LN_Temp");
	$result_Temp = $db->query("CREATE TEMPORARY TABLE LN_Temp (ISO VARCHAR(3) NOT NULL, ROD_Code VARCHAR(5) NOT NULL, Variant_Code VARCHAR(1) NULL, LN VARCHAR(50) NOT NULL) ENGINE = MEMORY CHARSET = utf8")  or die ("Query failed: " . $db->error . "</body></html>");
	$i=0;
	$num=$result->numrows;
	while ($i < $num) {
		$ISO=$row['ISO");								// ISO
		$ROD_Code=$row['ROD_Code");						// ROD_Code
		$Variant_Code=$row['Variant_Code");				// Variant_Code
		$LN_English=$row['LN_English");					// boolean
		$LN_Spanish=$row['LN_Spanish");					// boolean
		$LN_Portuguese=$row['LN_Portuguese");			// boolean
		$LN_French=$row['LN_French");					// boolean
		$LN_Dutch=$row['LN_Dutch");						// boolean
		$def_LN=$row['def_LN");							// default langauge (a 2 digit number for the national langauge)
		if (!$LN_Spanish) {													// if the Spanish then the default langauge
			switch ($def_LN){
				case 1:
					$query="SELECT LN_English FROM LN_English WHERE LN_English.ISO = '$ISO' AND LN_English.ROD_Code = '$ROD_Code'";
					$result_LN=$db->query($query);
					$LN=$result_LN['LN_English");
					break;
				case 2:
					$query="SELECT LN_Spanish FROM LN_Spanish WHERE LN_Spanish.ISO = '$ISO' AND LN_Spanish.ROD_Code = '$ROD_Code'";
					$result_LN=$db->query($query);
					$LN=$result_LN['LN_Spanish");
					break;
				case 3:
					$query="SELECT LN_Portuguese FROM LN_Portuguese WHERE LN_Portuguese.ISO = '$ISO' AND LN_Portuguese.ROD_Code = '$ROD_Code'";
					$result_LN=$db->query($query);
					$LN=$result_LN['LN_Portuguese");
					break;	
				case 4:
					$query="SELECT LN_French FROM LN_French WHERE LN_French.ISO = '$ISO' AND LN_French.ROD_Code = '$ROD_Code'";
					$result_LN=$db->query($query);
					$LN=$result_LN['LN_French");
					break;	
				case 5:
					$query="SELECT LN_Dutch FROM LN_Dutch WHERE LN_Dutch.ISO = '$ISO' AND LN_Dutch.ROD_Code = '$ROD_Code'";
					$result_LN=$db->query($query);
					$LN=$result_LN['LN_Dutch");
					break; 	
				default:
					echo "Isn't supposed to happen! The default language isn't here.";
					break;
			}
		}
		else {
			$query="SELECT LN_Spanish FROM LN_Spanish WHERE LN_Spanish.ISO = '$ISO' AND LN_Spanish.ROD_Code = '$ROD_Code'";
			$result_LN=$db->query($query);
			$LN=$result_LN['LN_Spanish");
		}
		$LN = check_input($LN);							// check_input: in order to make the INSERT work right
		$result_Temp = $db->query("INSERT INTO LN_Temp (ISO, ROD_Code, Variant_Code, LN) VALUES ('$ISO', '$ROD_Code', '$Variant_Code', '$LN')");
		$i++;
	}

	// Create 'Espanol.htm'
	$filename = 'Espanol.htm';
	$handle = fopen($filename,"w");		// Open for writing only; place the file pointer at the beginning of the file and truncate the file to zero length. If the file does not exist, attempt to create it. 
	fwrite($handle, $fileFirstPart);
	$j=0;

	$query="SELECT DISTINCT LN_Temp.LN, scripture_main.ISO, scripture_main.ROD_Code, scripture_main.Variant_Code FROM LN_Temp, scripture_main WHERE LN_Temp.ISO = scripture_main.ISO AND LN_Temp.ROD_Code = scripture_main.ROD_Code ORDER BY LN_Temp.LN";
	$result = $db->query($query);
	$num=$result->numrows;
	$i=0;
	if ($Display) {
		echo "<table border='0' style='width: 980px; margin: 0px; padding: 0px; '>";
		echo "<tr valign='bottom' style='text-align: left; color: black; margin: 0px; padding: 0px; '>";
		echo "<th width='28%'>Language Name:</th>";
		echo "<th width='31%'>Alternate Language Name:</th>";
		echo "<th width='15%'>ISO:</th>";
		echo "<th width='26%'>Country:</th>";
	}
	$fileFourthPart .= PHP_EOL . "<table border='0' style='width: 980px; margin: 0px; padding: 0px; '>" . PHP_EOL .
		"<tr valign='bottom' style='text-align: left; color: black; margin: 0px; padding: 0px; '>" . PHP_EOL .
		"<th width='28%'>Lengua:</th>" . PHP_EOL .
		"<th width='31%'>Nombre alternativo de la lengua:</th>" . PHP_EOL .
		"<th width='15%'>ISO:</th>" . PHP_EOL .
		"<th width='26%'>País:</th>" . PHP_EOL .
		"</tr>" . PHP_EOL;
	while ($i < $num) {
		if ($i % 2)
			$color = "ffffff";
		else
			$color = "f0f4f0";
		$ISO = $row['scripture_main.ISO");
		$ROD_Code = $row['scripture_main.ROD_Code");
		$Variant_Code = $row['scripture_main.Variant_Code");
		$LN = $row['LN_Temp.LN");

		if ($Display) {
			echo "<tr valign='bottom' style='color: navy; background-color: #$color; margin: 0px; padding: 0px; '>";
			echo "<td width='28%' style='background-color: #$color; margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>$LN</td>";
		}
		$fileFourthPart .= "<tr valign='bottom' style='color: navy; background-color: #$color; margin: 0px; padding: 0px; '>" . PHP_EOL .
			"<td width='28%' style='background-color: #$color; margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '><a href='../../00e-Escrituras_Indice.php?sortby=lang&name=$ISO&ROD_Code=$ROD_Code&Variant_Code=$Variant_Code'>$LN</a></td>" . PHP_EOL;
		//$alt_lang_names=$row['scripture_main.alt_lang_names");
		//if ($alt_lang_names > 0) {
		$query_alt="SELECT alt_lang_name FROM alt_lang_names WHERE ISO = '$ISO' AND ROD_Code = '$ROD_Code' AND Variant_Code = '$Variant_Code'";				// alt_lang_names
		$result_alt=$db->query($query_alt);
		$alt = "";
		$Temp = "";
		if (mysql_numrows($result_alt) > 0) {
			$num_alt=mysql_numrows($result_alt);
			if ($Display) {
				echo "<td width='31%' style='background-color: #$color; margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>";
			}
			$fileFourthPart .= "<td width='31%' style='background-color: #$color; margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>" . PHP_EOL;
			$i_alt=0;
			$Temp = "";
			while ($i_alt < $num_alt) {
				if ($i_alt <> 0) {
					$Temp .= ", ";
				}
				$alt_lang_name=mysql_result($result_alt,$i_alt,"alt_lang_name");
				if ($alt == "") {
					$alt = $alt_lang_name;
				}
				else {
					$alt = $alt . ", " . $alt_lang_name;
				}
				$i_alt++;
			}
			$Temp = $alt;
			$fileFourthPart .= $Temp;
			if ($Display) {
				echo $Temp;
				echo "</td>";
			}
			$fileFourthPart .= "</td>" . PHP_EOL;
		}
		else {
			if ($Display) {
				echo "<td width='31%' style='margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>&nbsp;</td>";
			}
			$fileFourthPart .= "<td width='31%'style='margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>&nbsp;</td>" . PHP_EOL;
		}

		//$ISO=$row['scripture_main.ISO");							// ISO
		//$ROD_Code=$row['scripture_main.ROD_Code");					// ROD_Code
		if ($Display) {
			echo "<td width='15%' style='margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>$ISO</td>";
		}
		$fileFourthPart .= "<td width='15%' style='margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>$ISO</td>" . PHP_EOL;

		$query="SELECT countries.Spanish FROM ISO_countries, countries WHERE ISO_countries.ISO = '$ISO' AND ISO_countries.ROD_Code = '$ROD_Code' AND ISO_countries.ISO_countries = countries.ISO_Country ORDER BY countries.Spanish";
		$result_ISO_countries=$db->query($query);
		$num_ISO_countries=mysql_numrows($result_ISO_countries);
		$Span_country = mysql_result($result_ISO_countries,0,"countries.Spanish");					// name of the country in the language version
		for ($i_ISO_countries = 1; $i_ISO_countries < $num_ISO_countries; $i_ISO_countries++) {
			$Span_country = $Span_country.', '.mysql_result($result_ISO_countries,$i_ISO_countries,"countries.Spanish");					// name of the country in the language version
		}
		if ($Display) {
			//echo "<td width='20%' style='background-color: #$color; margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>$Eng_country</td>";
			echo "<td width='26%' style='margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>$Span_country</td>";
			echo "</tr>";
		}
		$fileFourthPart .= "<td width='26%' style='margin: 0px; padding: 3px 5px 3px 5px; border-width: thin; border-style: none; border-color: #$color; '>$Span_country</td>" . PHP_EOL .
			"</tr>" . PHP_EOL;

		// 	$fileSecondPart
		$Temp2 = $LN;
		if ($Temp != "")
			$Temp2 .= ", " . $Temp;
		$Temp2 .= ", " . $ISO;
		if ($ROD_Code != "00000")
			$Temp2 .= ", " . $ROD_Code;
		fwrite($handle, $Temp2 . PHP_EOL);

		// Do it!
		// $fileFourthPart .= '<a href="' . $ISO . $ROD_Code . '.htm">' . $ISO . $ROD_Code . '</a><br />' . PHP_EOL;
		/*
		$fileCreate = str_replace('#zzz#', $ISO, $fileCreate);
		$fileCreate = str_replace('#qqqqq#', $ROD_Code, $fileCreate);
		$fileCreate = str_replace('#llllllllll#', $LN, $fileCreate);
		$Temp = $ISO . ", " . $LN . ", " . $Span_country;
		if ($alt != "") {
			$Temp = $Temp . ", " . $alt;
		}
		$fileCreate = str_replace('#kkkkkkkkkk#', $Temp, $fileCreate);
		fwrite($handle, $fileCreate);
		*/

		$i++;
	}
	if ($Display) {
		echo "</table>";
		echo "</div>";
	}
	$fileFourthPart .= "</table>";
	
	fwrite($handle, $fileThirdPart);
	
	fwrite($handle, $fileFourthPart);
	
	fwrite($handle, $fileFifthPart);
	
	fclose($handle);

	/* Explicitly destroy the table */
	$db->query("DROP TABLE LN_Temp");
?>
</body>
</html>
